<div class="historial-container">
  <div class="tabla-historial">
    <div class="header">
      <h2>Historial Médico</h2>
      <div class="actions">
        <button class="btn add" (click)="abrirFormulario()">
          <span class="material-icons">add</span> Agregar Historial
        </button>
        <div class="search-box">
          <input
            type="text"
            placeholder="Buscar por medicamento..."
            [(ngModel)]="terminoBusqueda"
          />
          <span class="material-icons search-icon">search</span>
        </div>
      </div>
    </div>

    <table class="styled-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Medicamento</th>
          <th>Detalles</th>
          <th>Notas</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let historial of filtrarHistoriales()" (click)="seleccionarHistorial(historial)" [class.selected]="historial === historialSeleccionado">
          <td>{{ historial.id }}</td>
          <td>{{ historial.medicamento }}</td>
          <td>{{ historial.detalles }}</td>
          <td>{{ historial.notas }}</td>
          <td class="actions">
            <button class="btn edit" (click)="editarHistorial(historial); $event.stopPropagation();">
              <span class="material-icons">edit</span>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Panel de detalle -->
  <div class="detalle-historial" *ngIf="historialSeleccionado">
    <div class="documento">
      <div class="encabezado">
        <h3>ApiarioSamano - Historial Médico</h3>
        <button class="btn print" (click)="imprimirHistorial()">
          <span class="material-icons">print</span> Imprimir
        </button>
      </div>
      <div class="contenido">
        <p><strong>ID:</strong> {{ historialSeleccionado.id }}</p>
        <p><strong>Medicamento:</strong> {{ historialSeleccionado.medicamento }}</p>
        <p><strong>Detalles:</strong> {{ historialSeleccionado.detalles }}</p>
        <p><strong>Notas:</strong> {{ historialSeleccionado.notas }}</p>
      </div>
    </div>
  </div>

  <!-- Modal de formulario -->
  <div class="modal" *ngIf="mostrarFormulario">
    <div class="modal-content">
      <h3>{{ editando ? 'Editar Historial' : 'Agregar Historial' }}</h3>
      <form (ngSubmit)="guardarHistorial()">
        <label>Medicamento:</label>
        <input type="text" [(ngModel)]="historialSeleccionado.medicamento" name="medicamento" required />
        <label>Detalles:</label>
        <textarea [(ngModel)]="historialSeleccionado.detalles" name="detalles"></textarea>
        <label>Notas:</label>
        <textarea [(ngModel)]="historialSeleccionado.notas" name="notas"></textarea>

        <div class="modal-actions">
          <button class="btn save" type="submit">
            <span class="material-icons">check</span> Guardar
          </button>
          <button class="btn cancel" type="button" (click)="cerrarFormulario()">
            <span class="material-icons">close</span> Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
